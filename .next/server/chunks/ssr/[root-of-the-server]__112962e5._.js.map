{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///home/user/sbspdmnds/src/app/admin/packages/actions.ts"],"sourcesContent":["'use server';\n\nimport { createClient } from '@supabase/supabase-js';\nimport { revalidatePath } from 'next/cache';\nimport { z } from 'zod';\n\n// CORREÇÃO: O esquema para a URL da imagem foi ajustado.\n// .url() - Garante que, se uma string for fornecida, ela DEVE ser uma URL válida.\n// .or(z.literal('')) - Permite que a string seja vazia.\n// .nullable().optional() - Permite que o campo seja nulo ou não definido.\n// Isso cobre todos os casos: URL válida, string vazia, ou ausência do campo.\nconst PackageSchema = z.object({\n  id: z.string().optional(),\n  origem: z.string().min(1, \"Origem é obrigatória.\"),\n  destino: z.string().min(1, \"Destino é obrigatório.\"),\n  data_ida: z.string().min(1, \"Data de ida é obrigatória.\"),\n  data_volta: z.string().nullable().optional(),\n  meio_transporte: z.string(),\n  companhia: z.string().nullable().optional(),\n  preco: z.coerce.number().positive(\"O preço deve ser positivo.\"),\n  disponibilidade: z.coerce.number().int().min(0, \"A disponibilidade não pode ser negativa.\"),\n  descricao: z.string().nullable().optional(),\n  imagem_url: z.string().url(\"URL da imagem inválida.\").or(z.literal('')).nullable().optional(),\n  categoria: z.string().nullable().optional(),\n  ativo: z.boolean(),\n});\n\ntype PackageFormData = z.infer<typeof PackageSchema>;\n\nconst createAdminClient = () => {\n  if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.SUPABASE_SERVICE_KEY) {\n    throw new Error('Variáveis de ambiente do Supabase não configuradas.');\n  }\n  return createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL,\n    process.env.SUPABASE_SERVICE_KEY\n  );\n};\n\n\nexport async function getPackageById(id: string) {\n  if (!id) return { error: { message: 'ID do pacote não fornecido.' } };\n  const supabaseAdmin = createAdminClient();\n  const { data, error } = await supabaseAdmin.from('viagens').select('*').eq('id', id).single();\n  if (error) {\n    console.error(`Erro ao buscar pacote com ID ${id}:`, error.message);\n    return { error };\n  }\n  return { pkg: data };\n}\n\n\nexport async function getPackages() {\n  const supabaseAdmin = createAdminClient();\n  const { data, error } = await supabaseAdmin.from('viagens').select('*').order('criado_em', { ascending: false });\n  if (error) {\n    console.error('Erro ao buscar pacotes:', error.message);\n    return { error };\n  }\n  return { packages: data };\n}\n\n\nexport async function createPackage(pkgData: PackageFormData) {\n  const validated = PackageSchema.safeParse(pkgData);\n  if (!validated.success) {\n    // Adicionando um log para ver os erros de validação no servidor\n    console.error(\"Erro de validação ao criar pacote:\", validated.error.flatten());\n    return { error: { message: validated.error.flatten().fieldErrors }};\n  }\n  \n  const supabaseAdmin = createAdminClient();\n  // Se a imagem_url for uma string vazia, converte para null antes de inserir\n  const dataToInsert = {\n    ...validated.data,\n    imagem_url: validated.data.imagem_url || null,\n  };\n\n  const { error } = await supabaseAdmin.from('viagens').insert(dataToInsert);\n  \n  if (error) {\n    console.error(\"Erro do Supabase ao criar pacote:\", error.message);\n    return { error };\n  }\n\n  revalidatePath('/admin/packages');\n  return { success: true };\n}\n\n\nexport async function updatePackage(pkgData: PackageFormData) {\n  const validated = PackageSchema.safeParse(pkgData);\n  if (!validated.success || !validated.data.id) {\n    return { error: { message: validated.success ? \"ID do pacote é necessário.\" : validated.error.flatten().fieldErrors }};\n  }\n\n  const { id, ...updateData } = validated.data;\n  \n  const dataToUpdate = {\n    ...updateData,\n    imagem_url: updateData.imagem_url || null,\n  };\n  \n  const supabaseAdmin = createAdminClient();\n  const { error } = await supabaseAdmin.from('viagens').update(dataToUpdate).eq('id', id);\n\n  if (error) {\n    console.error(\"Erro do Supabase ao atualizar pacote:\", error.message);\n    return { error };\n  }\n\n  revalidatePath('/admin/packages');\n  revalidatePath(`/packages/${id}`);\n  return { success: true };\n}\n\n\nexport async function deletePackage(packageId: string) {\n  if (!packageId) return { error: { message: \"ID do pacote é necessário.\" } };\n  const supabaseAdmin = createAdminClient();\n  const { error } = await supabaseAdmin.from('viagens').delete().eq('id', packageId);\n  if (error) {\n    console.error(\"Erro do Supabase ao deletar pacote:\", error.message);\n    return { error };\n  }\n  revalidatePath('/admin/packages');\n  return { success: true };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///home/user/sbspdmnds/.next-internal/server/app/admin/packages/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getPackages as '0091c3dda44fb1e8a6c2cb8d8f139281980e82b4d2'} from 'ACTIONS_MODULE0'\nexport {createPackage as '40ba2d1cf38d8987c4aa57df19bb108e3ee05c633f'} from 'ACTIONS_MODULE0'\nexport {updatePackage as '40001207baa1d7ee4d2926d93cda70d1e13b520f8d'} from 'ACTIONS_MODULE0'\nexport {deletePackage as '40a900ca3f7d6e023557003139b613e6227fc03008'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 251, "column": 0}, "map": {"version":3,"sources":["file:///home/user/sbspdmnds/src/app/admin/packages/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/packages/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/packages/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAmS,GAChU,iEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 265, "column": 0}, "map": {"version":3,"sources":["file:///home/user/sbspdmnds/src/app/admin/packages/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/packages/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/packages/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA+Q,GAC5S,6CACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 279, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}